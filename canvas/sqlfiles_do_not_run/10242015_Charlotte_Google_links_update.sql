begin transaction;

UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1HD8MMtE1_etbI0nJtvPEtg-3adEatIGQCfB-V5XQLv8', new_doc_id = '1HD8MMtE1_etbI0nJtvPEtg-3adEatIGQCfB-V5XQLv8', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253667;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1kZPnu4Ss7s7oCxF0jyhfqza8x7svQG_wpEoxkkCJAfo', new_doc_id = '1kZPnu4Ss7s7oCxF0jyhfqza8x7svQG_wpEoxkkCJAfo', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253614;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1eJfFUbeufV0wert_nitSqco8ONAo9syKi3w1Z4gNAN0', new_doc_id = '1eJfFUbeufV0wert_nitSqco8ONAo9syKi3w1Z4gNAN0', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253649;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1D8C6kmKUE8m5NfYojsOEYY-rcYbmGz8AAYoz6LnEz18', new_doc_id = '1D8C6kmKUE8m5NfYojsOEYY-rcYbmGz8AAYoz6LnEz18', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253690;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1N1b3XQbUc7-PoW4dasWAkpXBV-79JlneD9wQV7HH61g', new_doc_id = '1N1b3XQbUc7-PoW4dasWAkpXBV-79JlneD9wQV7HH61g', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253766;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1kkLSRu0BPBGKbRC11rPtL1JEcMgbRtb9vt8g3CqGGrI', new_doc_id = '1kkLSRu0BPBGKbRC11rPtL1JEcMgbRtb9vt8g3CqGGrI', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253643;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1fixxuBgyrIBmRGhenJhq_yflyaa9Pv92QQcdA_dI1tI', new_doc_id = '1fixxuBgyrIBmRGhenJhq_yflyaa9Pv92QQcdA_dI1tI', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253713;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1BAYAfWNtEQcUzo3L0q3EWRfQM15W-ATOpJxU7eEgodA', new_doc_id = '1BAYAfWNtEQcUzo3L0q3EWRfQM15W-ATOpJxU7eEgodA', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253725;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1RQZ3JkM7vIkDW6nb4R7JR1Mla2v1L7q77twPN-uDUc4', new_doc_id = '1RQZ3JkM7vIkDW6nb4R7JR1Mla2v1L7q77twPN-uDUc4', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253631;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1GYwG6N9JYrJS5lYoL1MZRePqgKAk4lxHxapVCZy0qLI', new_doc_id = '1GYwG6N9JYrJS5lYoL1MZRePqgKAk4lxHxapVCZy0qLI', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263445;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1SJ4m4gBeznfPU3nUv3vTG4LRHz0C5yp8UotIRA_DtVo', new_doc_id = '1SJ4m4gBeznfPU3nUv3vTG4LRHz0C5yp8UotIRA_DtVo', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253701;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1amjEpO-Q3L5r0h_3LDetQB_3MOx_UZgLD5s3g8kqxsU', new_doc_id = '1amjEpO-Q3L5r0h_3LDetQB_3MOx_UZgLD5s3g8kqxsU', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263598;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1JzfnSK0UEsjfc_Q339SWxRBs14HzigL3y6oPjKWSiqY', new_doc_id = '1JzfnSK0UEsjfc_Q339SWxRBs14HzigL3y6oPjKWSiqY', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263663;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1Byy8P6_MfBuW4tpO3HZYGXwmS51lqVWFFsbEc7f7qaA', new_doc_id = '1Byy8P6_MfBuW4tpO3HZYGXwmS51lqVWFFsbEc7f7qaA', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263592;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1AcBgtc4ogpcxjJXApJ4JAvsAJjZywxjuux66s5xapRk', new_doc_id = '1AcBgtc4ogpcxjJXApJ4JAvsAJjZywxjuux66s5xapRk', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263439;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1FE-SX9Juw3nAz2nahoNcT-gC3gYEYVEKhl6WGNXO-3c', new_doc_id = '1FE-SX9Juw3nAz2nahoNcT-gC3gYEYVEKhl6WGNXO-3c', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253737;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1BinXKySOI0z2pqn76uJud7-RpplhgQ04b88LLJgY2Ds', new_doc_id = '1BinXKySOI0z2pqn76uJud7-RpplhgQ04b88LLJgY2Ds', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263580;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1Kp9mz3BnBUf2D67z6sDLiPw458ap6pRHCcu4Ls1uetY', new_doc_id = '1Kp9mz3BnBUf2D67z6sDLiPw458ap6pRHCcu4Ls1uetY', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263463;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1rbb5RFkHFCB9drfli1R1GJxJOSSbUelsBdQepF0WPsY', new_doc_id = '1rbb5RFkHFCB9drfli1R1GJxJOSSbUelsBdQepF0WPsY', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253532;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1RL38fLpJ7LrXGftZDa774JqtrVjrKvnczox0qqcoMzo', new_doc_id = '1RL38fLpJ7LrXGftZDa774JqtrVjrKvnczox0qqcoMzo', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253637;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1BRB8DG5We2dzBOhi3esxDEBu66_jzOMJw46VezDwh-U', new_doc_id = '1BRB8DG5We2dzBOhi3esxDEBu66_jzOMJw46VezDwh-U', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253620;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1Lu6Qs0HXhQa6oeRaSNsnHBv7RtElNbBILJkBTWc9zIc', new_doc_id = '1Lu6Qs0HXhQa6oeRaSNsnHBv7RtElNbBILJkBTWc9zIc', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253608;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1vmMjCuF3xp6TI0FJV20YdLMuyGq3c0iJdGCL1_4k1M0', new_doc_id = '1vmMjCuF3xp6TI0FJV20YdLMuyGq3c0iJdGCL1_4k1M0', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263639;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1oxttd4tI0Moi5QGk0dVTbw32g_nwKMT9Ijp4IM2AsTo', new_doc_id = '1oxttd4tI0Moi5QGk0dVTbw32g_nwKMT9Ijp4IM2AsTo', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253521;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1Qcf_5pM83LQboDsnkDnLe3VXarJu1-jxLGWYEu9mLeY', new_doc_id = '1Qcf_5pM83LQboDsnkDnLe3VXarJu1-jxLGWYEu9mLeY', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253684;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1kIYKH3TEAV4AEZRxBMJsC9AgWF3Eflhxwtg8Y-9jt_U', new_doc_id = '1kIYKH3TEAV4AEZRxBMJsC9AgWF3Eflhxwtg8Y-9jt_U', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253655;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1IvuAxCITv-ajG6yRk2_HSFmDuGCNjPZB0p7X0YStFnE', new_doc_id = '1IvuAxCITv-ajG6yRk2_HSFmDuGCNjPZB0p7X0YStFnE', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263556;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1QmCMH23EIjtMTQGaG4P9nfU1TaZXZnEQQnhxIQPGgw0', new_doc_id = '1QmCMH23EIjtMTQGaG4P9nfU1TaZXZnEQQnhxIQPGgw0', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253719;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1fzJdLrWigOW7nzJBYCIGa7OU3gnh8OUun9d3lKmPtA0', new_doc_id = '1fzJdLrWigOW7nzJBYCIGa7OU3gnh8OUun9d3lKmPtA0', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253661;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1eB_arU9FHAmo2yQLNaierLq5xNrFJvgMEhNjvb6jujE', new_doc_id = '1eB_arU9FHAmo2yQLNaierLq5xNrFJvgMEhNjvb6jujE', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263616;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1dEJMjxuv5afJPv1h3diuDCxHGZ1TDNp9QOciMTN4OMQ', new_doc_id = '1dEJMjxuv5afJPv1h3diuDCxHGZ1TDNp9QOciMTN4OMQ', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263651;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1qMVQ4UdQyVpmNN6tG0dQm9f_Ev1oAmCB0JjsGAF0eSA', new_doc_id = '1qMVQ4UdQyVpmNN6tG0dQm9f_Ev1oAmCB0JjsGAF0eSA', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263645;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1PWqerbSgjmbm_0Yx8PeMAP9C3wE0oc8Af5wZmt9fyyo', new_doc_id = '1PWqerbSgjmbm_0Yx8PeMAP9C3wE0oc8Af5wZmt9fyyo', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253792;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1s7vpnl4aaeaX3O6xQrrkDV0FDW8BAQbq_lTBEOOmBPk', new_doc_id = '1s7vpnl4aaeaX3O6xQrrkDV0FDW8BAQbq_lTBEOOmBPk', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253673;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1Wgf_1dsxdnKpxHe_wJ2YewIpcgk7mWzHiKANi1XTdLM', new_doc_id = '1Wgf_1dsxdnKpxHe_wJ2YewIpcgk7mWzHiKANi1XTdLM', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263657;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1vWk--qxUJUCkpgjw8ZFwyuvbDNvCvAJBcuaNzb9Pmb0', new_doc_id = '1vWk--qxUJUCkpgjw8ZFwyuvbDNvCvAJBcuaNzb9Pmb0', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253515;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1gW9HE7mlW9k3izUFwL19phpY4G5LAoQzASXe7KdWfLk', new_doc_id = '1gW9HE7mlW9k3izUFwL19phpY4G5LAoQzASXe7KdWfLk', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253743;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1ZFUfM4JIoAEozn6x_WVee5i5W1TLFRm3akNiiSo01WM', new_doc_id = '1ZFUfM4JIoAEozn6x_WVee5i5W1TLFRm3akNiiSo01WM', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263550;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1XpsyK_IwYkoUeTfay8hWWWTDxrpIhFItkVCQT2HqaMQ', new_doc_id = '1XpsyK_IwYkoUeTfay8hWWWTDxrpIhFItkVCQT2HqaMQ', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263627;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1Ti1jVt9bivYiz4spcM35U23OotKoUNER5d2TwEH4S7Q', new_doc_id = '1Ti1jVt9bivYiz4spcM35U23OotKoUNER5d2TwEH4S7Q', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263457;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1cpVt2sERBQbOojuyAGkVv14_6BgLIB1l0c9CYf1LeOE', new_doc_id = '1cpVt2sERBQbOojuyAGkVv14_6BgLIB1l0c9CYf1LeOE', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263696;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1uCvpGgcU5sbd30hlcevuJJeSMYIOLQgN6_BQaryT2ME', new_doc_id = '1uCvpGgcU5sbd30hlcevuJJeSMYIOLQgN6_BQaryT2ME', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253707;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1pkbjQZXN1MmioUVCcVgot1eVjeK8dgMYtqkAbI9JQ0M', new_doc_id = '1pkbjQZXN1MmioUVCcVgot1eVjeK8dgMYtqkAbI9JQ0M', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253749;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1SST6i5lZiYyXi9JszHQUQu9HktlUOppqmYfawCIb28Q', new_doc_id = '1SST6i5lZiYyXi9JszHQUQu9HktlUOppqmYfawCIb28Q', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263521;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1RtfSBLyu88ie4X3ycQZJhU8wZudRyUJMG6N6qtdjaiI', new_doc_id = '1RtfSBLyu88ie4X3ycQZJhU8wZudRyUJMG6N6qtdjaiI', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 253731;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1tnIk-y8CYsHyZybGk0nxP_4E5nt8GXjOjveD5dx9VlQ', new_doc_id = '1tnIk-y8CYsHyZybGk0nxP_4E5nt8GXjOjveD5dx9VlQ', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263532;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/13oTClva4IdwjOmKDTvfeXpU2ZjohFbZlqqZfxINIRiI', new_doc_id = '13oTClva4IdwjOmKDTvfeXpU2ZjohFbZlqqZfxINIRiI', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263604;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1D5AJXmx5h9Pn7xeLCWGcQVBFb3Zz5zYQOfoQ6_iSAuo', new_doc_id = '1D5AJXmx5h9Pn7xeLCWGcQVBFb3Zz5zYQOfoQ6_iSAuo', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263574;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1IpGsnnKHnMKxoJ2WTk4LJ_EB5bZhrrE-7537gHnlzfs', new_doc_id = '1IpGsnnKHnMKxoJ2WTk4LJ_EB5bZhrrE-7537gHnlzfs', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263451;
UPDATE canvas_widget_content_copy SET url = 'https://docs.google.com/drawings/d/1sCaeaPsp_Xcs112uClZIJkWy34YN_geuvvQwrZWjlWE', new_doc_id = '1sCaeaPsp_Xcs112uClZIJkWy34YN_geuvvQwrZWjlWE', orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU' WHERE id = 263633;
--50 rows.

/*
--Sanity Checks
select * from canvas_widget_content_copy where id = 263580
select email from iuser_user where id = 176457
--keyaziadeveaux2001@gmail.com
--jevon.white2001@gmail.com
--crudup990@gmail.com
--tionnasuber.ts@gmail.com

--Step 1: Retrieve the links mentors used to create their posters in lesson 9.1.6.

select
	cwcc.id as "cwcc_id",
	imh.mentee_id as "mentee_persona_id",
	ip.id as "mentor_persona_id",
	cwcc.new_doc_id as "new_doc_id",
	'https://docs.google.com/drawings/d/' || cwcc.new_doc_id as "url"
from canvas_set_copy as csc
join canvas_app_copy as cac on cac.canvas_set_id = csc.id
join canvas_widget_copy as cwc on cwc.canvas_app_id = cac.id
join canvas_widget_content_copy as cwcc on cwcc.widget_id = cwc.id
join iuser_persona as ip on ip.id = csc.persona_id
join iuser_user as iu on iu.id = ip.user_id
join iuser_persona_partners as ipp on ipp.persona_id = ip.id
join iuser_matchhistory as imh on mentor_id = ip.id
where csc.parent_id = 84 --9.1.6 mentor lesson
	and cwcc.new_doc_id is not null
	and ipp.partner_id in (2445, 2315)
	and cwcc.html ilike 'start your poster%'
	and cwcc.url is null

--Step 2: Retrieve the generic links of mentees of those mentors in lesson 9.1.7.

select
	cwcc.*
from canvas_widget_content_copy as cwcc
join canvas_widget_copy as cwc on cwc.id = cwcc.widget_id
join canvas_app_copy as cac on cac.id = cwc.canvas_app_id
join canvas_set_copy as csc on csc.id = cac.canvas_set_id
where csc.parent_id = 86 --9.1.7 mentee lesson
	and cwcc.content_type = 6
	and cwcc.html is null
	and cwcc.url is not null
	and csc.persona_id in (
select
	imh.mentee_id as "mentee_persona_id"
from canvas_set_copy as csc
join canvas_app_copy as cac on cac.canvas_set_id = csc.id
join canvas_widget_copy as cwc on cwc.canvas_app_id = cac.id
join canvas_widget_content_copy as cwcc on cwcc.widget_id = cwc.id
join iuser_persona as ip on ip.id = csc.persona_id
join iuser_user as iu on iu.id = ip.user_id
join iuser_persona_partners as ipp on ipp.persona_id = ip.id
join iuser_matchhistory as imh on mentor_id = ip.id
where csc.parent_id = 84 --9.1.6 mentor lesson
	and cwcc.new_doc_id is not null
	and ipp.partner_id in (2445, 2315) --These are two affected classes at BBBS Charlotte.
	and cwcc.html ilike 'start your poster%' --We want the links embedded in the HTML card.
	and cwcc.url is null
)

--Below are just experiments.

begin transaction;

with google_links as (
select
	cwcc.id as "cwcc_id",
	imh.mentee_id as "mentee_persona_id",
	ip.id as "mentor_persona_id",
	cwcc.new_doc_id as "new_doc_id",
	'https://docs.google.com/drawings/d/' || cwcc.new_doc_id as "url"
from canvas_set_copy as csc
join canvas_app_copy as cac on cac.canvas_set_id = csc.id
join canvas_widget_copy as cwc on cwc.canvas_app_id = cac.id
join canvas_widget_content_copy as cwcc on cwcc.widget_id = cwc.id
join iuser_persona as ip on ip.id = csc.persona_id
join iuser_user as iu on iu.id = ip.user_id
join iuser_persona_partners as ipp on ipp.persona_id = ip.id
join iuser_matchhistory as imh on mentor_id = ip.id
where csc.parent_id = 84 --9.1.6 mentor lesson
	and cwcc.new_doc_id is not null
	and ipp.partner_id in (2445, 2315)
	and cwcc.html ilike 'start your poster%'
	and cwcc.url is null
)
update canvas_widget_content_copy as cwcc
set
	url = gl.url,
	new_doc_id = gl.new_doc_id,
	orig_doc_id = '1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU'
from google_links as gl
join canvas_widget_copy as cwc on cwc.id = cwcc.widget_id
join canvas_app_copy as cac on cac.id = cwc.canvas_app_id
join canvas_set_copy as csc on csc.id = cac.canvas_set_id
where csc.parent_id = 86 --9.1.7 mentee lesson
	--and csc.persona_id = gl.mentee_persona_id
	and csc.persona_id in (104063,104073,102745)
	and cwcc.content_type = 6
	and cwcc.html is null
	and cwcc.url is not null
--3 rows.

select
	cwcc.*
from canvas_widget_content_copy as cwcc
join canvas_widget_copy as cwc on cwc.id = cwcc.widget_id
join canvas_app_copy as cac on cac.id = cwc.canvas_app_id
join canvas_set_copy as csc on csc.id = cac.canvas_set_id
where csc.parent_id = 86 --9.1.7 mentee lesson
	and csc.persona_id in (
select
	imh.mentee_id as "mentee_persona_id"
from canvas_set_copy as csc
join canvas_app_copy as cac on cac.canvas_set_id = csc.id
join canvas_widget_copy as cwc on cwc.canvas_app_id = cac.id
join canvas_widget_content_copy as cwcc on cwcc.widget_id = cwc.id
join iuser_persona as ip on ip.id = csc.persona_id
join iuser_user as iu on iu.id = ip.user_id
join iuser_persona_partners as ipp on ipp.persona_id = ip.id
join iuser_matchhistory as imh on mentor_id = ip.id
where csc.parent_id = 84 --9.1.6 mentor lesson
	and cwcc.new_doc_id is not null
	and ipp.partner_id in (2445, 2315)
	and cwcc.html ilike 'start your poster%'
	and cwcc.url is null
)
	and cwcc.content_type = 6
	and cwcc.html is null
	and cwcc.url is not null

select
	cwcc.*
from canvas_set_copy as csc
join canvas_curriculum_copy as ccc on ccc.id = csc.curriculum_id
join canvas_app_copy as cac on cac.canvas_set_id = csc.id
join canvas_widget_copy as cwc on cwc.canvas_app_id = cac.id
join canvas_widget_content_copy as cwcc on cwcc.widget_id = cwc.id
join iuser_persona as ip on ip.id = csc.persona_id
join iuser_user as iu on iu.id = ip.user_id
join iuser_persona_partners as ipp on ipp.persona_id = ip.id
join partners_partner as ppa on ppa.id = ipp.partner_id
where csc.parent_id in (86)
	and cwcc.new_doc_id is null
	and ppa.id in (2445, 2315)
	and content_type = 6
order by
	ip.id asc

https://docs.google.com/drawings/d/1dV74vNQldV3esu583f7py_FajgKAusLFL9xB5g8A4PU/edit
select id, partner_id, start, end_date from partners_session where description = 'About Me: I Am' and start::date <= '10/23/15'
select id, partner_id, start, end_date from partners_session where description = 'About Me: I Am' and start::date > '10/23/15'

select
	cwcc.*
from canvas_set_copy as csc
join canvas_curriculum_copy as ccc on ccc.id = csc.curriculum_id
join canvas_app_copy as cac on cac.canvas_set_id = csc.id
join canvas_widget_copy as cwc on cwc.canvas_app_id = cac.id
join canvas_widget_content_copy as cwcc on cwcc.widget_id = cwc.id
join iuser_persona as ip on ip.id = csc.persona_id
join iuser_user as iu on iu.id = ip.user_id
join iuser_persona_partners as ipp on ipp.persona_id = ip.id
where csc.parent_id in (86)
	--and cwcc.new_doc_id is not null
	and ipp.id in (2445, 2315)
	--and cwcc.url is not null

https://docs.google.com/drawings/d/1MxzvBzEENZETU6dyo2eXf-1jvRlkM4ItrZnOnA8lQbg

select id, name from partners_partner where id in (2445, 2315)

select id, user_id from iuser_persona where id in (98598,103293,96715)
select id, user_id from iuser_persona where id in (104063,104073,102745)

98598 > 104063 > 177737 > https://docs.google.com/drawings/d/1kkLSRu0BPBGKbRC11rPtL1JEcMgbRtb9vt8g3CqGGrI
103293 > 104073 > 177747 > https://docs.google.com/drawings/d/1SJ4m4gBeznfPU3nUv3vTG4LRHz0C5yp8UotIRA_DtVo
96715 > 102745 > 176467 > https://docs.google.com/drawings/d/1vmMjCuF3xp6TI0FJV20YdLMuyGq3c0iJdGCL1_4k1M0

select user_id from iuser_persona where id = 102743

select * from canvas_widget_content_copy where id = 190211
select mentee_id from iuser_matchhistory where mentor_id = 103582
*/